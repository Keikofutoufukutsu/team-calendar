<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>松川村少年野球愛好会</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Hiragino Kaku Gothic Pro', 'Meiryo', sans-serif;
            background-color: #f0f5ff;
        }
        .calendar-day {
            min-height: 100px;
            transition: all 0.3s;
        }
        .calendar-day:hover {
            background-color: #e6efff;
        }
        .event {
            border-radius: 4px;
            padding: 2px 6px;
            margin-bottom: 2px;
            font-size: 0.8rem;
            cursor: pointer;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .practice {
            background-color: #bbdefb;
            border-left: 3px solid #1976d2;
        }
        .game {
            background-color: #ffcdd2;
            border-left: 3px solid #d32f2f;
        }
        .modal {
            transition: opacity 0.3s ease;
        }
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #f44336;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .tab-active {
            border-bottom: 2px solid #1976d2;
            color: #1976d2;
            font-weight: bold;
        }
        .attendance-yes {
            background-color: #c8e6c9;
            color: #2e7d32;
        }
        .attendance-no {
            background-color: #ffcdd2;
            color: #c62828;
        }
        .attendance-unknown {
            background-color: #fff9c4;
            color: #f9a825;
        }
    </style>
</head>
<body>
<header class="mb-8 max-w-6xl mx-auto px-4 py-4">
  <h1 class="text-3xl font-bold text-blue-800 mb-4">⚾ 松川村少年野球愛好会 </h1>

  <div class="flex space-x-4 mt-2">
    </button>
    <button id="notificationBtn" class="flex-1 bg-white hover:bg-gray-100 text-gray-800 px-4 py-2 rounded-lg border border-gray-300 flex items-center justify-center">
      <i class="fas fa-bell mr-2"></i> 連絡事項
      <span class="notification-badge ml-2">3</span>

    </button>
    <button id="addEventBtn" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center justify-center">
      <i class="fas fa-plus mr-2"></i> 予定追加
    </button>
    <button id="membersBtn" class="flex-1 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center justify-center">
      <i class="fas fa-users mr-2"></i> メンバー
    </button>
  </div>
</header>

        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center">
                    <button id="prevMonth" class="text-gray-600 hover:text-blue-600 p-2">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <h2 id="currentMonth" class="text-2xl font-bold mx-4">2023年11月</h2>
                    <button id="nextMonth" class="text-gray-600 hover:text-blue-600 p-2">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                <div class="flex space-x-2">
                    <div class="flex items-center">
                        <span class="inline-block w-3 h-3 bg-blue-300 mr-1"></span>
                        <span class="text-sm">練習</span>
                    </div>
                    <div class="flex items-center">
                        <span class="inline-block w-3 h-3 bg-red-300 mr-1"></span>
                        <span class="text-sm">試合</span>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-7 gap-2 mb-2">
                <div class="text-center font-semibold">月</div>
                <div class="text-center font-semibold">火</div>
                <div class="text-center font-semibold">水</div>
                <div class="text-center font-semibold">木</div>
                <div class="text-center font-semibold">金</div>
                <div class="text-center font-semibold text-blue-600">土</div>
                <div class="text-center font-semibold text-red-600">日</div>
            </div>

            <div id="calendar" class="grid grid-cols-7 gap-2">
                <!-- カレンダーの日付はJSで動的に生成 -->
            </div>
        </div>
    </div>

    <!-- 予定追加モーダル -->
    <div id="eventModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50 modal">
        <div class="bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">予定を追加</h3>
                <button id="closeEventModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="eventForm">
                <input type="hidden" id="eventId">
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">タイトル</label>
                    <input type="text" id="eventTitle" class="w-full px-3 py-2 border rounded-lg" required>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-gray-700 mb-2">日付</label>
                        <input type="date" id="eventDate" class="w-full px-3 py-2 border rounded-lg" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">時間</label>
                        <input type="time" id="eventTime" class="w-full px-3 py-2 border rounded-lg" required>
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">種類</label>
                    <select id="eventType" class="w-full px-3 py-2 border rounded-lg">
                        <option value="practice">練習</option>
                        <option value="game">試合</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">場所</label>
                    <input type="text" id="eventLocation" class="w-full px-3 py-2 border rounded-lg" required>
                </div>
                <div id="gameItemsContainer" class="mb-4 hidden">
                    <label class="block text-gray-700 mb-2">持ち物</label>
                    <textarea id="gameItems" class="w-full px-3 py-2 border rounded-lg" rows="3"></textarea>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">詳細</label>
                    <textarea id="eventDetails" class="w-full px-3 py-2 border rounded-lg" rows="3"></textarea>
                </div>
                
                <!-- 出欠確認セクション（試合の場合のみ表示） -->
                <div id="attendanceContainer" class="mb-4 hidden">
                    <div class="border-t border-gray-300 pt-4 mb-2">
                        <h4 class="font-bold text-lg mb-2">出欠確認</h4>
                        <p class="text-sm text-gray-600 mb-4">メンバーの出欠を設定してください。後から変更することもできます。</p>
                    </div>
                     <div class="mt-4 text-sm text-gray-700">
       　　　　　　　　　 <span id="attendanceCount-yes">0</span>人参加・
       　　　　　　　　　 <span id="attendanceCount-no">0</span>人不参加・
       　　　　　　　　　 <span id="attendanceCount-unknown">0</span>人未回答
   　　　　　　　　　 </div>
                    <div id="attendanceList" class="space-y-2">
                        <!-- 出欠リストはJSで動的に生成 -->
                    </div>
                </div>
                
                <div class="flex justify-end">
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                        保存
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- 予定詳細モーダル -->
    <div id="eventDetailsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50 modal">
        <div class="bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 id="detailsTitle" class="text-xl font-bold">予定詳細</h3>
                <button id="closeDetailsModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="mb-4">
                <p><strong>日時:</strong> <span id="detailsDateTime"></span></p>
                <p><strong>種類:</strong> <span id="detailsType"></span></p>
                <p><strong>場所:</strong> <span id="detailsLocation"></span></p>
                <div id="detailsItemsContainer" class="hidden">
                    <p><strong>持ち物:</strong></p>
                    <p id="detailsItems" class="mt-1 p-3 bg-gray-50 rounded-lg"></p>
                </div>
                <p class="mt-2"><strong>詳細:</strong></p>
                <p id="detailsContent" class="mt-1 p-3 bg-gray-50 rounded-lg"></p>
            </div>
            
            <!-- 出欠状況表示（試合の場合のみ） -->
            <div id="detailsAttendanceContainer" class="mb-4 hidden">
                updateAttendanceDisplay(event); 
                <div class="border-t border-gray-300 pt-4 mb-2">
                    <h4 class="font-bold text-lg">出欠状況</h4>
                    <div class="flex space-x-4 mt-2 mb-4">
                        <div class="flex items-center">
                            <span class="inline-block w-3 h-3 bg-green-200 mr-1"></span>
                            <span class="text-sm">参加</span>
                        </div>
                        <div class="flex items-center">
                            <span class="inline-block w-3 h-3 bg-red-200 mr-1"></span>
                            <span class="text-sm">不参加</span>
                        </div>
                        <div class="flex items-center">
                            <span class="inline-block w-3 h-3 bg-yellow-200 mr-1"></span>
                            <span class="text-sm">未回答</span>
                        </div>
                    </div>
                </div>
                <div id="detailsAttendanceList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2">
                    <!-- 出欠リストはJSで動的に生成 -->
                </div>
                <div class="mt-4">
                    <p><strong>参加:</strong> <span id="attendanceCount-yes">0</span>人</p>
                    <p><strong>不参加:</strong> <span id="attendanceCount-no">0</span>人</p>
                    <p><strong>未回答:</strong> <span id="attendanceCount-unknown">0</span>人</p>
                </div>
            </div>
            
            <div class="flex justify-end space-x-2">
                <button id="editEvent" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                    編集
                </button>
                <button id="deleteEvent" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg">
                    削除
                </button>
            </div>
        </div>
    </div>

    <!-- 連絡事項モーダル -->
    <div id="notificationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50 modal">
        <div class="bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">連絡事項</h3>
                <button id="closeNotificationModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="mb-4">
                <button id="addNotificationBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center">
                    <i class="fas fa-plus mr-2"></i> 新規連絡事項
                </button>
            </div>
            <div id="notificationList" class="space-y-4 max-h-96 overflow-y-auto">
                <!-- 連絡事項はJSで動的に生成 -->
            </div>
        </div>
    </div>

    <!-- 連絡事項追加/編集モーダル -->
    <div id="addNotificationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50 modal">
        <div class="bg-white rounded-lg p-6 w-full max-w-md">
            <div class="flex justify-between items-center mb-4">
                <h3 id="notificationModalTitle" class="text-xl font-bold">連絡事項を追加</h3>
                <button id="closeAddNotificationModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="notificationForm">
                <input type="hidden" id="notificationId">
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">タイトル</label>
                    <input type="text" id="notificationTitle" class="w-full px-3 py-2 border rounded-lg" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">発信者</label>
                    <select id="notificationSender" class="w-full px-3 py-2 border rounded-lg" required>
                        <option value="">発信者を選択</option>
                        <!-- 発信者リストはJSで動的に生成 -->
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">内容</label>
                    <textarea id="notificationContent" class="w-full px-3 py-2 border rounded-lg" rows="5" required></textarea>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">重要度</label>
                    <select id="notificationPriority" class="w-full px-3 py-2 border rounded-lg">
                        <option value="normal">通常</option>
                        <option value="important">重要</option>
                        <option value="urgent">緊急</option>
                    </select>
                </div>
                <div class="flex justify-end">
                    <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg">
                        保存
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- メンバー一覧モーダル -->
    <div id="membersModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50 modal">
        <div class="bg-white rounded-lg p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">メンバー一覧</h3>
                <button id="closeMembersModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="mb-4">
                <button id="addFamilyBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center">
                    <i class="fas fa-plus mr-2"></i> 新規家族登録
                </button>
            </div>
            <div class="mb-4 flex border-b">
                <button class="tab-active py-2 px-4" data-tab="allMembers">全メンバー</button>
                <button class="py-2 px-4" data-tab="byGrade">学年別</button>
            </div>
            <div id="allMembersTab" class="tab-content">
                <div id="membersList" class="space-y-4">
                    <!-- メンバーリストはJSで動的に生成 -->
                </div>
            </div>
            <div id="byGradeTab" class="tab-content hidden">
                <div id="gradesList" class="space-y-4">
                    <!-- 学年別リストはJSで動的に生成 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 家族登録モーダル -->
    <div id="addFamilyModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50 modal">
        <div class="bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 id="familyModalTitle" class="text-xl font-bold">新規家族登録</h3>
                <button id="closeAddFamilyModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="familyForm">
                <input type="hidden" id="familyId">
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">家族名（姓）</label>
                    <input type="text" id="familyName" class="w-full px-3 py-2 border rounded-lg" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">保護者氏名</label>
                    <input type="text" id="parentName" class="w-full px-3 py-2 border rounded-lg" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">連絡先電話番号</label>
                    <input type="tel" id="phoneNumber" class="w-full px-3 py-2 border rounded-lg" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">メールアドレス</label>
                    <input type="email" id="emailAddress" class="w-full px-3 py-2 border rounded-lg" required>
                </div>
                
                <div class="mb-4">
                    <div class="flex justify-between items-center">
                        <h4 class="font-bold">子供情報</h4>
                        <button type="button" id="addChildBtn" class="text-blue-600 hover:text-blue-800">
                            <i class="fas fa-plus"></i> 子供を追加
                        </button>
                    </div>
                    <div id="childrenContainer" class="space-y-4 mt-2">
                        <!-- 子供情報フォームはJSで動的に生成 -->
                    </div>
                </div>
                
                <div class="flex justify-end">
                    <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg">
                        保存
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // カレンダーの初期化
            let currentDate = new Date();
            let currentYear = currentDate.getFullYear();
            let currentMonth = currentDate.getMonth();
            
            // サンプルイベントデータ
            let events = [
                { 
                    id: 1, 
                    title: '通常練習', 
                    date: '2023-11-06', 
                    time: '17:00', 
                    type: 'practice', 
                    location: '市民グラウンド', 
                    details: '基礎トレーニングと打撃練習を行います。', 
                    items: '' 
                },
                { 
                    id: 2, 
                    title: '紅白戦', 
                    date: '2023-11-13', 
                    time: '13:00', 
                    type: 'practice', 
                    location: '中央公園野球場', 
                    details: 'チーム内紅白戦を行います。全員参加でお願いします。', 
                    items: '' 
                },
                { 
                    id: 3, 
                    title: '対外試合 vs 青葉クラブ', 
                    date: '2023-11-18', 
                    time: '10:00', 
                    type: 'game', 
                    location: '市民グラウンド', 
                    details: '青葉クラブとの試合があります。9:00集合です。', 
                    items: 'ユニフォーム、帽子、グローブ、バット、スパイク、弁当、水筒',
                    attendance: [
                        { childId: 1, status: 'yes' },
                        { childId: 2, status: 'no' },
                        { childId: 3, status: 'yes' },
                        { childId: 4, status: 'unknown' }
                    ]
                },
                { 
                    id: 4, 
                    title: '投手練習', 
                    date: '2023-11-22', 
                    time: '18:00', 
                    type: 'practice', 
                    location: '学校グラウンド', 
                    details: '投手陣のみの特別練習です。', 
                    items: '' 
                },
                { 
                    id: 5, 
                    title: '通常練習', 
                    date: '2023-11-27', 
                    time: '17:00', 
                    type: 'practice', 
                    location: '市民グラウンド', 
                    details: '守備練習を中心に行います。', 
                    items: '' 
                }
            ];

            // サンプル連絡事項データ
            let notifications = [
                { 
                    id: 1, 
                    title: 'ユニフォーム注文について', 
                    content: '新しいユニフォームの注文を来週の水曜日までに行います。サイズ確認をお願いします。', 
                    priority: 'normal', 
                    date: '2023/11/10',
                    sender: '山田太郎'
                },
                { 
                    id: 2, 
                    title: '次回練習場所変更のお知らせ', 
                    content: '11/15(水)の練習は中央公園グラウンドに変更となります。時間は変わらず18:00開始です。', 
                    priority: 'important', 
                    date: '2023/11/08',
                    sender: '佐藤花子'
                },
                { 
                    id: 3, 
                    title: 'チーム親睦会のお知らせ', 
                    content: '11/25(土)に親睦会を開催します。参加可能な方は11/20までに返信をお願いします。', 
                    priority: 'normal', 
                    date: '2023/11/05',
                    sender: '鈴木一郎'
                }
            ];

            // サンプルメンバーデータ
            let families = [
                { 
                    id: 1, 
                    familyName: '山田', 
                    parentName: '山田太郎', 
                    phoneNumber: '090-1234-5678', 
                    emailAddress: 'yamada@example.com',
                    children: [
                        { id: 1, name: '山田一郎', enrollmentYear: 2017, position: '投手' },
                        { id: 2, name: '山田二郎', enrollmentYear: 2019, position: '捕手' }
                    ]
                },
                { 
                    id: 2, 
                    familyName: '佐藤', 
                    parentName: '佐藤花子', 
                    phoneNumber: '090-8765-4321', 
                    emailAddress: 'sato@example.com',
                    children: [
                        { id: 3, name: '佐藤健太', enrollmentYear: 2018, position: '内野手' }
                    ]
                },
                { 
                    id: 3, 
                    familyName: '鈴木', 
                    parentName: '鈴木一郎', 
                    phoneNumber: '090-2345-6789', 
                    emailAddress: 'suzuki@example.com',
                    children: [
                        { id: 4, name: '鈴木大輔', enrollmentYear: 2017, position: '外野手' }
                    ]
                }
            ];

            // カレンダー表示更新
            function updateCalendar() {
                const calendarEl = document.getElementById('calendar');
                calendarEl.innerHTML = '';
                
                document.getElementById('currentMonth').textContent = `${currentYear}年${currentMonth + 1}月`;
                
                const firstDay = new Date(currentYear, currentMonth, 1);
                const lastDay = new Date(currentYear, currentMonth + 1, 0);
                
                // 月曜始まりにするための調整
                let firstDayIndex = firstDay.getDay() - 1;
                if (firstDayIndex < 0) firstDayIndex = 6; // 日曜日の場合は6に
                
                // 前月の日を追加
                for (let i = 0; i < firstDayIndex; i++) {
                    const prevMonthDay = new Date(currentYear, currentMonth, -i);
                    const dayEl = createDayElement(prevMonthDay, true);
                    calendarEl.prepend(dayEl);
                }
                
                // 当月の日を追加
                for (let i = 1; i <= lastDay.getDate(); i++) {
                    const date = new Date(currentYear, currentMonth, i);
                    const dayEl = createDayElement(date, false);
                    calendarEl.appendChild(dayEl);
                }
                
                // 翌月の日を追加（6週間表示のため）
                const totalCells = calendarEl.childElementCount;
                const cellsNeeded = 42; // 6週間分
                const daysNeeded = cellsNeeded - totalCells;
                
                for (let i = 1; i <= daysNeeded; i++) {
                    const nextMonthDay = new Date(currentYear, currentMonth + 1, i);
                    const dayEl = createDayElement(nextMonthDay, true);
                    calendarEl.appendChild(dayEl);
                }
            }
            
            // 日付要素の作成
            function createDayElement(date, isOtherMonth) {
                const dayEl = document.createElement('div');
                dayEl.className = `calendar-day border p-1 ${isOtherMonth ? 'text-gray-400 bg-gray-50' : 'bg-white'}`;
                
                // 日曜日は赤、土曜日は青に
                if (date.getDay() === 0) {
                    dayEl.classList.add('text-red-600');
                } else if (date.getDay() === 6) {
                    dayEl.classList.add('text-blue-600');
                }
                
                const dateHeader = document.createElement('div');
                dateHeader.className = 'text-right font-semibold mb-1';
                dateHeader.textContent = date.getDate();
                dayEl.appendChild(dateHeader);
                
                const eventsContainer = document.createElement('div');
                eventsContainer.className = 'events-container';
                
                // その日のイベントを追加
                const dateStr = date.toISOString().split('T')[0];
                const dayEvents = events.filter(event => event.date === dateStr);
                
                dayEvents.forEach(event => {
                    const eventEl = document.createElement('div');
                    eventEl.className = `event ${event.type === 'practice' ? 'practice' : 'game'}`;
                    eventEl.textContent = event.title;
                    eventEl.dataset.eventId = event.id;
                    
                    eventEl.addEventListener('click', function(e) {
                        e.stopPropagation();
                        showEventDetails(event);
                    });
                    
                    eventsContainer.appendChild(eventEl);
                });
                
                dayEl.appendChild(eventsContainer);
                
                // 日付クリックで予定追加
                dayEl.addEventListener('click', function() {
                    document.getElementById('eventDate').value = dateStr;
                    document.getElementById('eventId').value = '';
                    document.getElementById('eventForm').reset();
                    document.getElementById('eventDate').value = dateStr;
                    document.getElementById('eventModal').classList.remove('hidden');
                });
                
                return dayEl;
            }
            
            // イベント詳細表示
            function showEventDetails(event) {
                const modal = document.getElementById('eventDetailsModal');
                document.getElementById('detailsTitle').textContent = event.title;
                document.getElementById('detailsDateTime').textContent = `${event.date} ${event.time}`;
                document.getElementById('detailsType').textContent = event.type === 'practice' ? '練習' : '試合';
                document.getElementById('detailsLocation').textContent = event.location;
                document.getElementById('detailsContent').textContent = event.details;
                
                // 持ち物の表示（試合の場合のみ）
                const itemsContainer = document.getElementById('detailsItemsContainer');
                if (event.type === 'game' && event.items) {
                    document.getElementById('detailsItems').textContent = event.items;
                    itemsContainer.classList.remove('hidden');
                } else {
                    itemsContainer.classList.add('hidden');
                }
                
                // 出欠状況の表示（試合の場合のみ）
                const attendanceContainer = document.getElementById('detailsAttendanceContainer');
                if (event.type === 'game') {
                    updateAttendanceDisplay(event);
                    attendanceContainer.classList.remove('hidden');
                } else {
                    attendanceContainer.classList.add('hidden');
                }
                
                // 編集ボタンのイベント
                document.getElementById('editEvent').onclick = function() {
                    document.getElementById('eventDetailsModal').classList.add('hidden');
                    
                    // 編集フォームに値をセット
                    document.getElementById('eventId').value = event.id;
                    document.getElementById('eventTitle').value = event.title;
                    document.getElementById('eventDate').value = event.date;
                    document.getElementById('eventTime').value = event.time;
                    document.getElementById('eventType').value = event.type;
                    document.getElementById('eventLocation').value = event.location;
                    document.getElementById('eventDetails').value = event.details;
                    
                    // 種類に応じて持ち物欄と出欠確認の表示/非表示
                    const gameItemsContainer = document.getElementById('gameItemsContainer');
                    const attendanceContainer = document.getElementById('attendanceContainer');
                    
                    if (event.type === 'game') {
                        document.getElementById('gameItems').value = event.items;
                        gameItemsContainer.classList.remove('hidden');
                        
                        // 出欠確認リストを更新
                        updateAttendanceForm(event);
                        attendanceContainer.classList.remove('hidden');
                    } else {
                        gameItemsContainer.classList.add('hidden');
                        attendanceContainer.classList.add('hidden');
                    }
                    
                    document.getElementById('eventModal').classList.remove('hidden');
                };
                
                // 削除ボタンのイベント
                document.getElementById('deleteEvent').onclick = function() {
                    if (confirm('この予定を削除してもよろしいですか？')) {
                        events = events.filter(e => e.id !== event.id);
                        updateCalendar();
                        modal.classList.add('hidden');
                    }
                };
                
                modal.classList.remove('hidden');
            }
            
            // 出欠確認フォームの更新
            function updateAttendanceForm(event) {
                const attendanceList = document.getElementById('attendanceList');
                attendanceList.innerHTML = '';
                
                // 全メンバーを取得
                const allChildren = getAllChildren();
                
                // 既存の出欠データを取得
                const attendance = event.attendance || [];
                
                allChildren.forEach(child => {
                    const childAttendance = attendance.find(a => a.childId === child.id);
                    const status = childAttendance ? childAttendance.status : 'unknown';
                    
                    const childEl = document.createElement('div');
                    childEl.className = 'border rounded p-3';
                    childEl.innerHTML = `
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="font-semibold">${child.name}</p>
                                <p class="text-sm text-gray-600">${child.familyName}家 / ${child.position}</p>
                            </div>
                            <div class="flex space-x-2">
                                <label class="inline-flex items-center">
                                    <input type="radio" name="attendance-${child.id}" value="yes" class="form-radio" ${status === 'yes' ? 'checked' : ''}>
                                    <span class="ml-1">参加</span>
                                </label>
                                <label class="inline-flex items-center">
                                    <input type="radio" name="attendance-${child.id}" value="no" class="form-radio" ${status === 'no' ? 'checked' : ''}>
                                    <span class="ml-1">不参加</span>
                                </label>
                                <label class="inline-flex items-center">
                                    <input type="radio" name="attendance-${child.id}" value="unknown" class="form-radio" ${status === 'unknown' ? 'checked' : ''}>
                                    <span class="ml-1">未定</span>
                                </label>
                            </div>
                        </div>
                    `;
                    
                    attendanceList.appendChild(childEl);
                });
            }
            
            // 出欠状況表示の更新
            function updateAttendanceDisplay(event) {
                const attendanceList = document.getElementById('detailsAttendanceList');
                attendanceList.innerHTML = '';
                
                // 全メンバーを取得
                const allChildren = getAllChildren();
                
                // 既存の出欠データを取得
                const attendance = event.attendance || [];
                
                // 出欠カウント
                let yesCount = 0;
                let noCount = 0;
                let unknownCount = 0;
                
                allChildren.forEach(child => {
                    const childAttendance = attendance.find(a => a.childId === child.id);
                    const status = childAttendance ? childAttendance.status : 'unknown';
                    
                    // カウント更新
                    if (status === 'yes') yesCount++;
                    else if (status === 'no') noCount++;
                    else unknownCount++;
                    
                    const childEl = document.createElement('div');
                    childEl.className = `border rounded p-2 attendance-${status}`;
                    childEl.innerHTML = `
                        <p class="font-semibold">${child.name}</p>
                        <p class="text-sm">${child.familyName}家 / ${child.position}</p>
                        <p class="text-sm font-medium mt-1">
                            ${status === 'yes' ? '参加' : status === 'no' ? '不参加' : '未回答'}
                        </p>
                    `;
                    
                    attendanceList.appendChild(childEl);
                });
                
                // カウント表示更新
                document.getElementById('attendanceCount-yes').textContent = yesCount;
                document.getElementById('attendanceCount-no').textContent = noCount;
                document.getElementById('attendanceCount-unknown').textContent = unknownCount;
            }
            
            // 全ての子供メンバーを取得
            function getAllChildren() {
                const allChildren = [];
                
                families.forEach(family => {
                    family.children.forEach(child => {
                        allChildren.push({
                            ...child,
                            familyName: family.familyName
                        });
                    });
                });
                
                return allChildren;
            }
            
            // 連絡事項の表示
            function updateNotifications() {
                const notificationList = document.getElementById('notificationList');
                notificationList.innerHTML = '';
                
                notifications.forEach(notification => {
                    const notificationEl = createNotificationElement(notification);
                    notificationList.appendChild(notificationEl);
                });
                
                // 通知バッジの更新
                document.querySelector('.notification-badge').textContent = notifications.length;
                
                // 発信者選択肢の更新
                updateSenderOptions();
            }
            
            // 発信者選択肢の更新
            function updateSenderOptions() {
                const senderSelect = document.getElementById('notificationSender');
                senderSelect.innerHTML = '<option value="">発信者を選択</option>';
                
                // 保護者リストを取得
                families.forEach(family => {
                    const option = document.createElement('option');
                    option.value = family.parentName;
                    option.textContent = `${family.parentName} (${family.familyName}家)`;
                    senderSelect.appendChild(option);
                });
            }
            
            // 連絡事項要素の作成
            function createNotificationElement(notification) {
                const notificationEl = document.createElement('div');
                
                let bgColor = 'bg-blue-50';
                let borderColor = 'border-blue-500';
                
                if (notification.priority === 'important') {
                    bgColor = 'bg-yellow-50';
                    borderColor = 'border-yellow-500';
                } else if (notification.priority === 'urgent') {
                    bgColor = 'bg-red-50';
                    borderColor = 'border-red-500';
                }
                
                notificationEl.className = `${bgColor} p-4 rounded-lg border-l-4 ${borderColor}`;
                notificationEl.innerHTML = `
                    <div class="flex justify-between items-start">
                        <h4 class="font-bold">${notification.title}</h4>
                        <span class="text-sm text-gray-500">${notification.date}</span>
                    </div>
                    <p class="text-sm text-gray-600 mt-1">発信者: ${notification.sender || '不明'}</p>
                    <p class="mt-2">${notification.content}</p>
                    <div class="flex justify-end mt-2">
                        <button class="edit-notification text-blue-600 hover:text-blue-800 text-sm" data-id="${notification.id}">編集</button>
                        <button class="delete-notification text-red-600 hover:text-red-800 text-sm ml-3" data-id="${notification.id}">削除</button>
                    </div>
                `;
                
                // 編集ボタンのイベント
                notificationEl.querySelector('.edit-notification').addEventListener('click', function() {
                    const id = parseInt(this.dataset.id);
                    const notification = notifications.find(n => n.id === id);
                    
                    document.getElementById('notificationModalTitle').textContent = '連絡事項を編集';
                    document.getElementById('notificationId').value = notification.id;
                    document.getElementById('notificationTitle').value = notification.title;
                    document.getElementById('notificationContent').value = notification.content;
                    document.getElementById('notificationPriority').value = notification.priority;
                    document.getElementById('notificationSender').value = notification.sender || '';
                    
                    document.getElementById('addNotificationModal').classList.remove('hidden');
                });
                
                // 削除ボタンのイベント
                notificationEl.querySelector('.delete-notification').addEventListener('click', function() {
                    const id = parseInt(this.dataset.id);
                    if (confirm('この連絡事項を削除してもよろしいですか？')) {
                        notifications = notifications.filter(n => n.id !== id);
                        updateNotifications();
                    }
                });
                
                return notificationEl;
            }
            
            // メンバー一覧の表示
            function updateMembers() {
                const membersList = document.getElementById('membersList');
                membersList.innerHTML = '';
                
                families.forEach(family => {
                    const familyEl = createFamilyElement(family);
                    membersList.appendChild(familyEl);
                });
                
                updateGradesList();
            }
            
            // 学年別メンバーリストの表示
            function updateGradesList() {
                const gradesList = document.getElementById('gradesList');
                gradesList.innerHTML = '';
                
                // 学年ごとにグループ化
                const gradeGroups = {};
                const currentYear = new Date().getFullYear();
                const currentMonth = new Date().getMonth();
                
                // 日本の学年は4月始まり
                const academicYearOffset = currentMonth < 3 ? 0 : 1;
                const academicYear = currentYear - 2012 + academicYearOffset; // 2012年入学が小学1年生の場合
                
                families.forEach(family => {
                    family.children.forEach(child => {
                        // 学年の計算（日本の学年制度に合わせる）
                        const grade = academicYear - (child.enrollmentYear - 2012);
                        const gradeText = grade <= 6 ? `小学${grade}年生` : `中学${grade - 6}年生`;
                        
                        if (!gradeGroups[gradeText]) {
                            gradeGroups[gradeText] = [];
                        }
                        
                        gradeGroups[gradeText].push({
                            name: child.name,
                            familyName: family.familyName,
                            position: child.position
                        });
                    });
                });
                
                // 学年順にソート
                const sortedGrades = Object.keys(gradeGroups).sort((a, b) => {
                    const aMatch = a.match(/(\d+)/);
                    const bMatch = b.match(/(\d+)/);
                    const aGrade = aMatch ? parseInt(aMatch[1]) : 0;
                    const bGrade = bMatch ? parseInt(bMatch[1]) : 0;
                    
                    if (a.includes('小学') && b.includes('中学')) return -1;
                    if (a.includes('中学') && b.includes('小学')) return 1;
                    
                    return aGrade - bGrade;
                });
                
                // 学年ごとにリストを作成
                sortedGrades.forEach(grade => {
                    const gradeEl = document.createElement('div');
                    gradeEl.className = 'mb-6';
                    
                    gradeEl.innerHTML = `
                        <h3 class="text-lg font-bold mb-2 bg-blue-100 p-2 rounded">${grade} (${gradeGroups[grade].length}名)</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2">
                            ${gradeGroups[grade].map(student => `
                                <div class="border p-2 rounded bg-white">
                                    <p class="font-semibold">${student.name}</p>
                                    <p class="text-sm text-gray-600">ポジション: ${student.position}</p>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    
                    gradesList.appendChild(gradeEl);
                });
            }
            
            // 家族要素の作成
            function createFamilyElement(family) {
                const familyEl = document.createElement('div');
                familyEl.className = 'border rounded-lg p-4 bg-white';
                
                // 現在の学年を計算
                const currentYear = new Date().getFullYear();
                const currentMonth = new Date().getMonth();
                const academicYearOffset = currentMonth < 3 ? 0 : 1;
                const academicYear = currentYear - 2012 + academicYearOffset;
                
                const childrenHtml = family.children.map(child => {
                    const grade = academicYear - (child.enrollmentYear - 2012);
                    const gradeText = grade <= 6 ? `小学${grade}年生` : `中学${grade - 6}年生`;
                    
                    return `
                        <div class="border-t pt-2 mt-2">
                            <p class="font-semibold">${child.name}</p>
                            <p class="text-sm">${gradeText} / ポジション: ${child.position}</p>
                        </div>
                    `;
                }).join('');
                
                familyEl.innerHTML = `
                    <div class="flex justify-between">
                        <h3 class="text-lg font-bold">${family.familyName}家</h3>
                        <div>
                            <button class="edit-family text-blue-600 hover:text-blue-800 mr-2" data-id="${family.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="delete-family text-red-600 hover:text-red-800" data-id="${family.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <p><i class="fas fa-user mr-1"></i> ${family.parentName}</p>
                    <p><i class="fas fa-phone mr-1"></i> ${family.phoneNumber}</p>
                    <p><i class="fas fa-envelope mr-1"></i> ${family.emailAddress}</p>
                    <div class="mt-2">
                        <h4 class="font-semibold">子供</h4>
                        ${childrenHtml}
                    </div>
                `;
                
                // 編集ボタンのイベント
                familyEl.querySelector('.edit-family').addEventListener('click', function() {
                    const id = parseInt(this.dataset.id);
                    const family = families.find(f => f.id === id);
                    
                    document.getElementById('familyModalTitle').textContent = '家族情報を編集';
                    document.getElementById('familyId').value = family.id;
                    document.getElementById('familyName').value = family.familyName;
                    document.getElementById('parentName').value = family.parentName;
                    document.getElementById('phoneNumber').value = family.phoneNumber;
                    document.getElementById('emailAddress').value = family.emailAddress;
                    
                    // 子供情報をセット
                    const childrenContainer = document.getElementById('childrenContainer');
                    childrenContainer.innerHTML = '';
                    
                    family.children.forEach(child => {
                        const childEl = createChildFormElement();
                        childEl.querySelector('.child-name').value = child.name;
                        childEl.querySelector('.child-enrollment-year').value = child.enrollmentYear;
                        childEl.querySelector('.child-position').value = child.position;
                        childrenContainer.appendChild(childEl);
                    });
                    
                    document.getElementById('addFamilyModal').classList.remove('hidden');
                });
                
                // 削除ボタンのイベント
                familyEl.querySelector('.delete-family').addEventListener('click', function() {
                    const id = parseInt(this.dataset.id);
                    if (confirm('この家族情報を削除してもよろしいですか？')) {
                        families = families.filter(f => f.id !== id);
                        updateMembers();
                    }
                });
                
                return familyEl;
            }
            
            // 子供フォーム要素の作成
            function createChildFormElement() {
                const childEl = document.createElement('div');
                childEl.className = 'child-form border rounded p-3 bg-gray-50';
                
                const currentYear = new Date().getFullYear();
                
                childEl.innerHTML = `
                    <div class="flex justify-between mb-2">
                        <h5 class="font-semibold">子供情報</h5>
                        <button type="button" class="remove-child text-red-600 hover:text-red-800">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="mb-2">
                        <label class="block text-gray-700 mb-1 text-sm">氏名</label>
                        <input type="text" class="child-name w-full px-3 py-2 border rounded-lg" required>
                    </div>
                    <div class="mb-2">
                        <label class="block text-gray-700 mb-1 text-sm">小学校入学年度</label>
                        <select class="child-enrollment-year w-full px-3 py-2 border rounded-lg">
                            ${Array.from({length: 10}, (_, i) => currentYear - i).map(year => 
                                `<option value="${year}">${year}年</option>`
                            ).join('')}
                        </select>
                    </div>
                    <div class="mb-2">
                        <label class="block text-gray-700 mb-1 text-sm">ポジション</label>
                        <select class="child-position w-full px-3 py-2 border rounded-lg">
                            <option value="投手">投手</option>
                            <option value="捕手">捕手</option>
                            <option value="内野手">内野手</option>
                            <option value="外野手">外野手</option>
                            <option value="未定">未定</option>
                        </select>
                    </div>
                `;
                
                // 削除ボタンのイベント
                childEl.querySelector('.remove-child').addEventListener('click', function() {
                    childEl.remove();
                });
                
                return childEl;
            }
            
            // 前月へ
            document.getElementById('prevMonth').addEventListener('click', function() {
                currentMonth--;
                if (currentMonth < 0) {
                    currentMonth = 11;
                    currentYear--;
                }
                updateCalendar();
            });
            
            // 翌月へ
            document.getElementById('nextMonth').addEventListener('click', function() {
                currentMonth++;
                if (currentMonth > 11) {
                    currentMonth = 0;
                    currentYear++;
                }
                updateCalendar();
            });
            
            // 予定追加ボタン
            document.getElementById('addEventBtn').addEventListener('click', function() {
                // フォームをリセット
                document.getElementById('eventId').value = '';
                document.getElementById('eventForm').reset();
                document.getElementById('eventDate').value = new Date().toISOString().split('T')[0];
                document.getElementById('gameItemsContainer').classList.add('hidden');
                document.getElementById('attendanceContainer').classList.add('hidden');
                document.getElementById('eventModal').classList.remove('hidden');
            });
            
            // 予定種類変更時の処理
            document.getElementById('eventType').addEventListener('change', function() {
                const gameItemsContainer = document.getElementById('gameItemsContainer');
                const attendanceContainer = document.getElementById('attendanceContainer');
                
                if (this.value === 'game') {
                    gameItemsContainer.classList.remove('hidden');
                    
                    // 出欠確認リストを更新
                    const eventId = document.getElementById('eventId').value;
                    let event = null;
                    
                    if (eventId) {
                        event = events.find(e => e.id === parseInt(eventId));
                    }
                    
                    updateAttendanceForm(event || {});
                    attendanceContainer.classList.remove('hidden');
                } else {
                    gameItemsContainer.classList.add('hidden');
                    attendanceContainer.classList.add('hidden');
                }
            });
            
            // 予定追加フォーム送信
            document.getElementById('eventForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const eventId = document.getElementById('eventId').value;
                const title = document.getElementById('eventTitle').value;
                const date = document.getElementById('eventDate').value;
                const time = document.getElementById('eventTime').value;
                const type = document.getElementById('eventType').value;
                const location = document.getElementById('eventLocation').value;
                const details = document.getElementById('eventDetails').value;
                const items = type === 'game' ? document.getElementById('gameItems').value : '';
                
                // 出欠データの収集（試合の場合のみ）
                let attendance = [];
                if (type === 'game') {
                    const allChildren = getAllChildren();
                    attendance = allChildren.map(child => {
                        const radioName = `attendance-${child.id}`;
                        const selectedRadio = document.querySelector(`input[name="${radioName}"]:checked`);
                        const status = selectedRadio ? selectedRadio.value : 'unknown';
                        
                        return {
                            childId: child.id,
                            status: status
                        };
                    });
                }
                
                if (eventId) {
                    // 既存イベントの更新
                    const index = events.findIndex(e => e.id === parseInt(eventId));
                    if (index !== -1) {
                        events[index] = {
                            ...events[index],
                            title,
                            date,
                            time,
                            type,
                            location,
                            details,
                            items,
                            attendance: type === 'game' ? attendance : undefined
                        };
                    }
                } else {
                    // 新しいイベントを追加
                    const newEvent = {
                        id: events.length > 0 ? Math.max(...events.map(e => e.id)) + 1 : 1,
                        title,
                        date,
                        time,
                        type,
                        location,
                        details,
                        items,
                        attendance: type === 'game' ? attendance : undefined
                    };
                    
                    events.push(newEvent);
                }
                
                updateCalendar();
                document.getElementById('eventModal').classList.add('hidden');
            });
            
            // 連絡事項ボタン
            document.getElementById('notificationBtn').addEventListener('click', function() {
                updateNotifications();
                document.getElementById('notificationModal').classList.remove('hidden');
            });
            
            // 新規連絡事項ボタン
            document.getElementById('addNotificationBtn').addEventListener('click', function() {
                document.getElementById('notificationModalTitle').textContent = '連絡事項を追加';
                document.getElementById('notificationId').value = '';
                document.getElementById('notificationForm').reset();
                updateSenderOptions();
                document.getElementById('addNotificationModal').classList.remove('hidden');
            });
            
            // 連絡事項フォーム送信
            document.getElementById('notificationForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const notificationId = document.getElementById('notificationId').value;
                const title = document.getElementById('notificationTitle').value;
                const content = document.getElementById('notificationContent').value;
                const priority = document.getElementById('notificationPriority').value;
                const sender = document.getElementById('notificationSender').value;
                
                const today = new Date();
                const dateStr = `${today.getFullYear()}/${String(today.getMonth() + 1).padStart(2, '0')}/${String(today.getDate()).padStart(2, '0')}`;
                
                if (notificationId) {
                    // 既存連絡事項の更新
                    const index = notifications.findIndex(n => n.id === parseInt(notificationId));
                    if (index !== -1) {
                        notifications[index] = {
                            ...notifications[index],
                            title,
                            content,
                            priority,
                            sender
                        };
                    }
                } else {
                    // 新しい連絡事項を追加
                    const newNotification = {
                        id: notifications.length > 0 ? Math.max(...notifications.map(n => n.id)) + 1 : 1,
                        title,
                        content,
                        priority,
                        sender,
                        date: dateStr
                    };
                    
                    notifications.push(newNotification);
                }
                
                updateNotifications();
                document.getElementById('addNotificationModal').classList.add('hidden');
            });
            
            // メンバー一覧ボタン
            document.getElementById('membersBtn').addEventListener('click', function() {
                updateMembers();
                document.getElementById('membersModal').classList.remove('hidden');
            });
            
            // タブ切り替え
            document.querySelectorAll('[data-tab]').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.dataset.tab;
                    
                    // タブのアクティブ状態を切り替え
                    document.querySelectorAll('[data-tab]').forEach(t => {
                        t.classList.remove('tab-active');
                    });
                    this.classList.add('tab-active');
                    
                    // タブコンテンツの表示/非表示を切り替え
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.add('hidden');
                    });
                    document.getElementById(`${tabName}Tab`).classList.remove('hidden');
                });
            });
            
            // 新規家族登録ボタン
            document.getElementById('addFamilyBtn').addEventListener('click', function() {
                document.getElementById('familyModalTitle').textContent = '新規家族登録';
                document.getElementById('familyId').value = '';
                document.getElementById('familyForm').reset();
                
                // 子供フォームをクリア
                const childrenContainer = document.getElementById('childrenContainer');
                childrenContainer.innerHTML = '';
                childrenContainer.appendChild(createChildFormElement());
                
                document.getElementById('addFamilyModal').classList.remove('hidden');
            });
            
            // 子供追加ボタン
            document.getElementById('addChildBtn').addEventListener('click', function() {
                const childrenContainer = document.getElementById('childrenContainer');
                childrenContainer.appendChild(createChildFormElement());
            });
            
            // 家族登録フォーム送信
            document.getElementById('familyForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const familyId = document.getElementById('familyId').value;
                const familyName = document.getElementById('familyName').value;
                const parentName = document.getElementById('parentName').value;
                const phoneNumber = document.getElementById('phoneNumber').value;
                const emailAddress = document.getElementById('emailAddress').value;
                
                // 子供情報の取得
                const childForms = document.querySelectorAll('.child-form');
                const children = Array.from(childForms).map((form, index) => {
                    return {
                        id: Date.now() + index,
                        name: form.querySelector('.child-name').value,
                        enrollmentYear: parseInt(form.querySelector('.child-enrollment-year').value),
                        position: form.querySelector('.child-position').value
                    };
                });
                
                if (familyId) {
                    // 既存家族の更新
                    const index = families.findIndex(f => f.id === parseInt(familyId));
                    if (index !== -1) {
                        families[index] = {
                            ...families[index],
                            familyName,
                            parentName,
                            phoneNumber,
                            emailAddress,
                            children
                        };
                    }
                } else {
                    // 新しい家族を追加
                    const newFamily = {
                        id: families.length > 0 ? Math.max(...families.map(f => f.id)) + 1 : 1,
                        familyName,
                        parentName,
                        phoneNumber,
                        emailAddress,
                        children
                    };
                    
                    families.push(newFamily);
                }
                
                updateMembers();
                document.getElementById('addFamilyModal').classList.add('hidden');
            });
            
            // モーダルを閉じる
            document.getElementById('closeEventModal').addEventListener('click', function() {
                document.getElementById('eventModal').classList.add('hidden');
            });
            
            document.getElementById('closeDetailsModal').addEventListener('click', function() {
                document.getElementById('eventDetailsModal').classList.add('hidden');
            });
            
            document.getElementById('closeNotificationModal').addEventListener('click', function() {
                document.getElementById('notificationModal').classList.add('hidden');
            });
            
            document.getElementById('closeAddNotificationModal').addEventListener('click', function() {
                document.getElementById('addNotificationModal').classList.add('hidden');
            });
            
            document.getElementById('closeMembersModal').addEventListener('click', function() {
                document.getElementById('membersModal').classList.add('hidden');
            });
            
            document.getElementById('closeAddFamilyModal').addEventListener('click', function() {
                document.getElementById('addFamilyModal').classList.add('hidden');
            });
            
            // モーダル外クリックで閉じる
            window.addEventListener('click', function(e) {
                const modals = document.querySelectorAll('.modal');
                modals.forEach(modal => {
                    if (e.target === modal) {
                        modal.classList.add('hidden');
                    }
                });
            });
            
            // 初期表示
            updateCalendar();
            updateNotifications();
        });
    </script>
</body>
</html>
